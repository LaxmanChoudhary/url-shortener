<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
        h1 { color: #333; }
        form { margin-bottom: 20px; }
        input[type="text"] { width: 300px; padding: 5px; }
        input[type="submit"] { padding: 5px 10px; }
        .url-container { display: flex; align-items: center; margin-top: 10px; }
        .short-url { margin-right: 10px; }
        .copy-btn { padding: 5px 10px; cursor: pointer; }
        .copy-success { color: green; margin-left: 10px; display: none; }
        #processed-url { color: #666; font-size: 0.9em; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>URL Shortener</h1>
    <form id="shorten-form">
        <input type="text" id="url-input" placeholder="Enter URL to shorten" required>
        <input type="submit" value="Shorten">
    </form>
    <div id="processed-url"></div>
    <div class="url-container" style="display: none;">
        <p class="short-url">Your shortened URL: <a href="#" id="shortened-url"></a></p>
        <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
        <span class="copy-success" id="copy-success">Copied!</span>
    </div>

    <script>
        function preprocessUrl(url) {
            if (!/^https?:\/\//i.test(url)) {
                return 'https://' + url;
            }
            return url;
        }

        document.getElementById('shorten-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var originalUrl = document.getElementById('url-input').value;
            var processedUrl = preprocessUrl(originalUrl);
            document.getElementById('processed-url').textContent = 'Processed URL: ' + processedUrl;

            fetch('/shorten', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({url: processedUrl}),
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('shortened-url').href = data.short_url;
                document.getElementById('shortened-url').textContent = data.short_url;
                document.querySelector('.url-container').style.display = 'flex';
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });

        function copyToClipboard() {
            var urlElement = document.getElementById("shortened-url");
            var url = urlElement.href;

            navigator.clipboard.writeText(url).then(function() {
                var successMessage = document.getElementById("copy-success");
                successMessage.style.display = "inline";
                setTimeout(function() {
                    successMessage.style.display = "none";
                }, 2000);
            }, function(err) {
                console.error('Could not copy text: ', err);
            });
        }
    </script>
</body>
</html>